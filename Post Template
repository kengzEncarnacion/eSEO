<?php
/**
 * Template Name: Single Blog Post
 */

get_header();

$word_count = str_word_count(strip_tags(get_the_content()));
$reading_time = ceil($word_count / 150); 

?>
<!-- Page Title -->
<div class="custom-blog-header" ">
	<div class="custom-blog-header-inner">
	<!-- Categories -->
		<div class="custom-blog-categories">
			<?php 
			$categories = get_the_category();
			if ( ! empty( $categories ) ) {
				$category_links = array();
				foreach ( $categories as $category ) {
					$category_links[] = '<a href="' . esc_url( get_category_link( $category->term_id ) ) . '" class="custom-category-link">' . esc_html( $category->name ) . '</a>';
				}
				echo implode(', ', $category_links);
			}
			?>
		</div>

		<h1 class="custom-blog-title"><?php the_title(); ?></h1>
        <div class="custom-blog-date">
			<?php echo get_the_date(); ?>
		</div>
	</div>
</div>



<!-- Body Container -->
<div class="custom-single-container">
	<aside class="custom-toc-sidebar">
		<div class="custom-toc-sticky">
			<!-- Reading Time & Fact Checked -->
			<div class="blog-info">

				<div class="read-container">
					<p class="reading-time"><?php echo $reading_time; ?> Min Read</p>
				</div>
				<!-- 	Table of Contents	-->
				<?php echo do_shortcode('[ez-toc]'); ?>
			</div>
		</div>
	</aside>


	<!-- Main Content Area -->
	<div class="custom-post-content">
		<?php while ( have_posts() ) : the_post(); ?>
		<article <?php post_class(); ?>>
			<div class="entry-content">
				<?php //the_content(); 
				if ( has_post_thumbnail() ) {
					echo '<div class="post-featured-image">';
					the_post_thumbnail('large'); 
					echo '</div>';
				}

				$content = get_the_content();
				$content = apply_filters( 'the_content', $content );
				$content = str_replace( ']]>', ']]&gt;', $content );

				$paragraphs = preg_split( '/(<\/p>)/i', $content, -1, PREG_SPLIT_DELIM_CAPTURE );

				$total_parts = count( $paragraphs );
				$half = ceil( $total_parts / 2 );

				$first_half = implode( '', array_slice( $paragraphs, 0, $half ) );
				$second_half = implode( '', array_slice( $paragraphs, $half ) );

				echo $first_half;

				echo $second_half;

				?>
			</div>
		</article>

		<?php endwhile; ?>

		<div class="post-navigation">
			<div class="prev-post">
				<?php previous_post_link('%link', '&lt; Previous'); ?>
			</div>
			<div class="next-post">
				<?php next_post_link('%link', 'Next &gt;'); ?>
			</div>
		</div>
	</div>

	<!-- Right Sidebar (CTA Area) -->
	<aside class="right-bar">
		<div class="cta-column">
			<div class="cta-box">
				<h3 class="title">Free Consultation</h3>
				<a href="#" class="button primary-btn">Contact Us!</a>
			</div>
			<div class="cta-box box2">
				<h3 class="title">Your journey starts here.</h3>
				<p>Meet the team</p>
				<a href="#"  class="button primary-btn calendly">Learn More</a>
			</div>
			<!-- New cta-box box3 for related blogs -->
			<div class="cta-box box3">
				<h3 class="title">Related Blogs</h3>
				<ul class="related-blogs">
					<?php
					// Fetch related blogs - customize as needed
					$related_posts = new WP_Query( array(
						'post_type' => 'post',
						'posts_per_page' => 3,
						'orderby' => 'date',
						'order' => 'DESC',
						// Add taxonomy or category filters if needed
					) );
					if ( $related_posts->have_posts() ) :
					while ( $related_posts->have_posts() ) : $related_posts->the_post(); ?>
					<li>
						<a href="<?php the_permalink(); ?>"><?php the_title(); ?></a>
					</li>
					<?php endwhile;
					wp_reset_postdata();
					else : ?>
					<li>No related blogs found.</li>
					<?php endif; ?>
				</ul>
			</div>
		</div>
	</aside>

</div>

<?php get_footer(); ?>




